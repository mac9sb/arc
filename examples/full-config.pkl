/// Full Arc configuration example.
///
/// This example demonstrates all available configuration options
/// including static sites, apps, Cloudflare Tunnel, and SSH.
amends "modulepath:/ArcConfiguration.pkl"

/// Port the proxy server listens on (default: 8080)
proxyPort = 8080

/// Directory for log files
logDir = "/var/log/arc"

/// Optional: Base directory for resolving relative paths
/// If not set, uses the directory containing this config file
// baseDir = "/path/to/project"

/// Health check interval in seconds
healthCheckInterval = 30

/// Server version displayed in status
version = "1.0.0"

/// Optional: Deployment region identifier
region = "local"

/// Optional: Custom process name (otherwise auto-generated)
// processName = "my-arc-server"

sites {
    /// Static portfolio site
    new StaticSite {
        name = "portfolio"
        domain = "portfolio.localhost"
        outputPath = "static/portfolio/.output"
        /// Optional: Custom watch targets
        // watchTargets {
        //     "static/portfolio/.output"
        // }
    }
    
    /// Static documentation site
    new StaticSite {
        name = "docs"
        domain = "docs.localhost"
        outputPath = "static/docs/.output"
    }
    
    /// API application
    new AppSite {
        name = "api"
        domain = "api.localhost"
        port = 8001
        healthPath = "/health"
        process {
            workingDir = "apps/api/Web"
            executable = ".build/release/API"
            env {
                ["DATABASE_URL"] = "postgres://localhost/mydb"
                ["REDIS_URL"] = "redis://localhost:6379"
                ["LOG_LEVEL"] = "info"
            }
        }
    }
    
    /// Main web application
    new AppSite {
        name = "web"
        domain = "localhost"
        port = 8002
        healthPath = "/health"
        process {
            workingDir = "apps/web/Web"
            executable = ".build/release/Web"
            env {
                ["API_URL"] = "http://api.localhost:8080"
            }
        }
    }
}

/// Cloudflare Tunnel configuration for public access
cloudflare {
    enabled = false  // Set to true to enable
    cloudflaredPath = "/opt/homebrew/bin/cloudflared"
    tunnelName = "my-tunnel"
    tunnelUUID = "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
}

/// SSH access configuration via Cloudflare Tunnel
ssh {
    enabled = false  // Set to true to enable
    domain = "ssh.example.com"
    port = 22
}

/// File watching configuration
watch {
    /// Watch config.pkl for changes and reload
    watchConfigPkl = true
    
    /// Follow symlinks when watching
    followSymlinks = false
    
    /// Debounce file change events (milliseconds)
    debounceMs = 300
    
    /// Cooldown after process restart (milliseconds)
    cooldownMs = 1000
}
